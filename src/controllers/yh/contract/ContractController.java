package controllers.yh.contract;import java.util.HashMap;import java.util.List;import java.util.Map;import models.Party;import com.jfinal.core.Controller;import com.jfinal.log.Logger;import com.jfinal.plugin.activerecord.Db;import com.jfinal.plugin.activerecord.Record;public class ContractController extends Controller {    private Logger logger = Logger.getLogger(ContractController.class);    // in config route已经将路径默认设置为/yh    // me.add("/yh", controllers.yh.AppController.class, "/yh");  /*  public void index() {        render("contract/ContractList.html");    }*/        public void customerContract(){        setAttr("contractType","CUSTOMER");        System.out.println("123123");        render("contract/ContractList.html");    }        public void spContract(){        setAttr("contractType","SP");        System.out.println("55555");        render("contract/ContractList.html");    }    public void customerList(){        String sLimit = "";        String pageIndex = getPara("sEcho");        if (getPara("iDisplayStart") != null && getPara("iDisplayLength") != null) {            sLimit = " LIMIT " + getPara("iDisplayStart") + ", " + getPara("iDisplayLength");        }                //获取总条数        String totalWhere="";        String sql = "select count(1) total from contract where type='CUSTOMER'";        System.out.println(sql);        Record rec = Db.findFirst(sql + totalWhere);        logger.debug("total records:" + rec.getLong("total"));                //获取当前页的数据        List<Record> orders = Db.find("select * from contract where type='CUSTOMER'");        Map orderMap = new HashMap();        orderMap.put("sEcho", pageIndex);        orderMap.put("iTotalRecords", rec.getLong("total"));        orderMap.put("iTotalDisplayRecords", rec.getLong("total"));        orderMap.put("aaData", orders);                renderJson(orderMap);    }        public void spList(){        String sLimit = "";        String pageIndex = getPara("sEcho");        if (getPara("iDisplayStart") != null && getPara("iDisplayLength") != null) {            sLimit = " LIMIT " + getPara("iDisplayStart") + ", " + getPara("iDisplayLength");        }                //获取总条数        String totalWhere="";        String sql = "select count(1) total from contract where type='SERVICE_PROVIDER'";        System.out.println(sql);        Record rec = Db.findFirst(sql + totalWhere);        logger.debug("total records:" + rec.getLong("total"));                //获取当前页的数据        List<Record> orders = Db.find("select * from contract where type='SERVICE_PROVIDER'");        Map orderMap = new HashMap();        orderMap.put("sEcho", pageIndex);        orderMap.put("iTotalRecords", rec.getLong("total"));        orderMap.put("iTotalDisplayRecords", rec.getLong("total"));        orderMap.put("aaData", orders);                renderJson(orderMap);      }       /* public void list() {                 * Paging                 String sLimit = "";        String pageIndex = getPara("sEcho");        if (getPara("iDisplayStart") != null && getPara("iDisplayLength") != null) {            sLimit = " LIMIT " + getPara("iDisplayStart") + ", " + getPara("iDisplayLength");        }                 * Filtering NOTE this does not match the built-in DataTables filtering         * which does it word by word on any field. It's possible to do here,         * but concerned about efficiency on very large tables, and MySQL's         * regex functionality is very limited                 String aColumns[] = { "building_name", "status", "type", "region", "area", "total", "intro", "remark", "create_date", "remark" };        String commonFilterWhere = "";        if (getPara("sSearch") != null && !"".equals(getPara("sSearch"))) {            commonFilterWhere = "WHERE (";            for (int i = 0; i < aColumns.length; i++) {                commonFilterWhere += aColumns[i] + " LIKE '%" + getPara("sSearch") + "%' OR ";            }            commonFilterWhere = commonFilterWhere.substring(0, commonFilterWhere.length() - 3);            commonFilterWhere += ')';        }        logger.debug("firtst filter:" + commonFilterWhere);        String sqlTotal = "select count(1) total from party where party_type='CUSTOMER'";        Record rec = Db.findFirst(sqlTotal);        logger.debug("total records:" + rec.getLong("total"));        String sql = "select * from party where party_type='CUSTOMER' order by create_date desc " + sLimit;        List<Record> orders = Db.find(sql);        for (Record record : orders) {            long partyId = record.getLong("id");            List<Record> partyAttrs = Db.find("select * from party_attribute where party_id=?", partyId);            for (Record attr : partyAttrs) {                if ("name".equals(attr.getStr("attr_name"))) {                    record.set("name", attr.getStr("attr_value"));                }                if ("address".equals(attr.getStr("attr_name"))) {                    record.set("address", attr.getStr("attr_value"));                }                if ("mobile".equals(attr.getStr("attr_name"))) {                    record.set("mobile", attr.getStr("attr_value"));                }                if ("company_name".equals(attr.getStr("attr_name"))) {                    record.set("company_name", attr.getStr("attr_value"));                }            }        }        Map customerListMap = new HashMap();        customerListMap.put("sEcho", pageIndex);        customerListMap.put("iTotalRecords", rec.getLong("total"));        customerListMap.put("iTotalDisplayRecords", rec.getLong("total"));        customerListMap.put("aaData", orders);        renderJson(customerListMap);    }*/    public void add() {        setAttr("saveOK", false);        render("/yh/contract/ContractEdit.html");    }    public void edit() {        long id = getParaToLong();        Party party = Party.dao.findById(id);        setAttr("party", party);        render("contract/ContractEdit.html");    }    public void save() {        setAttr("saveOK", true);        redirect("/yh/customerContract/edit/");    }        //列出客户公司名称    public void seach(){        String companyName = getPara("companyName");        // 不能查所有        if (companyName.trim().length() > 0) {            List<Record> companyList = Db.find("select * from location where name like '%" + companyName + "%'");            renderJson(companyList);        }    }}