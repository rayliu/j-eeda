

<%layout("/yh/layout.html"){%>

        <div id="page-wrapper">
            
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">             
                           角色权限
                           
                    </h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>

           <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">

                    <div class="panel panel-default">                              
                        <div class="panel-heading">

                               <i class="fa fa-list fa-fw"></i>角色权限编辑

                        </div>

                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <div class="row">
                                <form>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label >角色(必选)</label>
											<select class="form-control" id="role" name="role">
											<option></option>
											<option>1</option>
											<option>2</option>
											<option>3</option>
											<option>4</option>
											<option>5</option>
											</select>
                                        </div>                                        
                                    </div>
                                </form>
                                
                                
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover" id="eeda-table">
                                    <thead>
                                        <tr>
                                      		<th>
                                      		<input type='checkbox' name='all_check_box' value=''>全选
                                      		</th>
                                            <th>模块名称</th>                                          
                                            <th>权限</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                    </tbody>
                                </table>
                            </div>
 <div class="row">
                                <form id='createForm' action="" method="post">
                                   
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <div class="controls">
                                              <a id="saveBtn" class="btn btn-primary" href="#">保存</a>
                                            </div>
                                        </div>
                                    </div>    
                                </form> 
                            </div>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
          
        </div>
       

<%}%>

<script src="/yh/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="/yh/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script>

$(document).ready(function() {

    $('#menu_finance').addClass('active').find('ul').addClass('in');
	var role =$("#role");
   	role.empty();
   	$.get('/yh/privilege/SelectUser?select=2',{},function(data){

		for(var i = 0; i < data.length; i++)
		{
			role.append("<option valuer='"+data[i].ID+"'>"+data[i].ROLE_NAME+"</option>");
		}
		
	},'json');
	//datatable, 动态处理
	
    var datatable = $('#eeda-table').dataTable({
        //"sDom": "<'row-fluid'<'span6'l><'span6'f>r>t<'row-fluid'<'span12'i><'span12 center'p>>",
        "sDom": "<'row-fluid'<'span6'l><'span6'f>r>t<'row-fluid'<'span12'i><'span12 center'p>>",
        //"sPaginationType": "bootstrap",
        "iDisplayLength": 10,
        "bServerSide": true,
    	"oLanguage": {
            "sUrl": "/eeda/dataTables.ch.txt"
        },
        "sAjaxSource": "/yh/privilege/privilegelist",
        "aoColumns": [
            { "mDataProp": null, "sWidth": "7%"	,
            	 "fnRender": function(obj) {
                     return '<input type="checkbox" name="order_check_box" value="'+obj.aData.ID+'">'+obj.aData.ID+'';
                  }	
            },
            { "mDataProp": "MODULE_NAME" , "sWidth": "15%"
            
            },
           
            { "mDataProp": null,
                "fnRender": function(obj) {
                   var returnStr="";
                   for(var i =0;i<obj.aData.MODULE_P.length;i++){
                	   if(obj.aData.MODULE_P[i].PRIVILEGE=="*"){
                			  returnStr+="<input type='checkbox'  name='pri_check_box' value='"+obj.aData.MODULE_P[i].ID+"'>全部" 
                		  }
                		  if(obj.aData.MODULE_P[i].PRIVILEGE=="create"){
                			  returnStr+="<input type='checkbox' name='pri_check_box' value='"+obj.aData.MODULE_P[i].ID+"'>添加" 
                		  }
                		  if(obj.aData.MODULE_P[i].PRIVILEGE=="update"){
                			  returnStr+="<input type='checkbox' name='pri_check_box' value='"+obj.aData.MODULE_P[i].ID+"'>更改" 
                		  }
                		  if(obj.aData.MODULE_P[i].PRIVILEGE=="delete"){
                			  returnStr+="<input type='checkbox' name='pri_check_box' value='"+obj.aData.MODULE_P[i].ID+"'>删除" 
                		  }
                		  if(obj.aData.MODULE_P[i].PRIVILEGE=="view"){
                			  returnStr+="<input type='checkbox' name='pri_check_box' value='"+obj.aData.MODULE_P[i].ID+"'>查看" 
                		  }

                   }
                		
                        return returnStr ;
                       
                 }
            
            },
          
        ],
        "fnInitComplete": function(oSettings, json) {
        	/* 
        	var che="";  
   		 $("#eeda-table").on('click', 'input[name="pri_check_box"]', function(){
    	    	che =$("input[type='checkbox']").is(':checked');
    	    });
   		
        	$("#eeda-table td").on('click', '', function(){
        		 
        	 hang = $(this).parent("tr").prevAll().length; 
       		  	hang = Number(hang)+1;
       		
        	
       		alert(hang);
        	});
        	*/    
        }       
    });	
	
    $('#saveBtn').click(function(e){
        e.preventDefault();
    	var	role=$("#role").val();
        //获取权限, 放到数组中
        var roles =[];    
		var tableArr = [];
		
		roles.push(role);
		tableArr.push(roles) ; 
       var check=true;
        $("table tr:not(:first)").each(function(){
        	 var trArr = [];
        	$("input:checked",this).each(function(){
        		trArr.push($(this).val());        		
        	});          	
        	 if(trArr.length>0){       		
        		 tableArr.push(trArr);
        	 }        	
        	}); 
       
      
      
        console.log(tableArr);
        $.ajax({//点击确定，保存设置
    		url: "/yh/privilege/editModule_pri",
    		type:'post',
    		//dataType : "object",
    		data : "localArr="+tableArr,
    		success: function(msg){
    			alert(msg);
    			$( "#dialog-modal").omDialog("close");
    		}
    	});

        //sendArr[0].toString();
        /*
        $.post("/yh/privilege/editModule_pri",{localArr:tableArr},function(data){     

        	   //回调函数 

        	   });
*/
    });
});	
</script>