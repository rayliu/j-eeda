
<%layout("/yh/layout.html"){%>
<link href="/yh/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet">
 

    <div id="wrapper">

        <div id="page-wrapper">
           
                <div class="col-lg-12">
                    <h1 class="page-header">回单</h1>
                   
                </div>
                <!-- /.col-lg-12 -->
            
            
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                       
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                          <div class="">
                        		 <div class="form-group">
                        		
                                        <label class="input-inline">回单号</label> <input class=" input-inline input-small" type="text" id="order_no">
                                         <label class="input-inline">运输单号</label> <input class=" input-inline input-small" type="text" id="tr_order_no">
                                         <label class="input-inline">配送单号</label> <input class=" input-inline input-small" type="text" id="de_order_no">
                                         <label class="input-inline">创建人</label> <input class=" input-inline input-small" type="text" id="stator">
                                         <label class="input-inline">状态</label> <input class=" input-inline input-small" type="text" id="status">
                                          <label class="input-inline">时间段</label> <div class="input-append input-inline input-small date" id="datetimepicker">  
							    <input type="text" class="input-inline input-small" id="time_one">
							    <span class="add-on">  
						        <i data-date-icon="icon-calendar" data-time-icon="icon-time" class="icon-calendar"></i>  
						    	</span>  
							</div>
							
							&nbsp至
                            <div id="datetimepicker2" class="input-append input-inline date ">  
							    <input id="time_two" class="input-inline input-small" type="text"></input>
							    <span class="add-on">  
						        <i data-time-icon="icon-time" data-date-icon="icon-calendar"></i>  
						    	</span>  
							</div>
                                    </div>  
                    		</div>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover" id="example">
                                    <thead>
                                        <tr>
                                            <th>回单编号</th>
                                            <th>客户名称</th>
                                            <th>类型</th>
                                            <th>运输单号</th>
                                            <th>配送单号</th>
                                            <th>回单创建人</th>                                   
                                            <th>创建时间</th> 
                                            <th>状态</th>
                                            <th>备注</th>                                          
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                                                                                                                            
                                    </tbody>
                                </table>
                            </div>
                            
                            
                        </div>
                       
                    </div>
                   
                </div>
               
            </div>
         
        </div>
        <!-- /#page-wrapper -->

    </div>
    <%}%>
    <!-- /#wrapper -->



    <!-- Page-Level Plugin Scripts - Tables -->
    <script src="/yh/js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="/yh/js/plugins/dataTables/dataTables.bootstrap.js"></script>
	<script src="/yh/js/bootstrap-datetimepicker.min.js"></script>
    <!-- Page-Level Demo Scripts - Tables - Use for reference -->
    <script>
    $('#datetimepicker').datetimepicker({  
        format: 'yyyy-MM-dd',  
        language: 'en',  
        pickDate: true,  
        pickTime: true,  
        hourStep: 1,  
        minuteStep: 15,  
        secondStep: 30,  
        inputMask: true  
      });
      $('#datetimepicker2').datetimepicker({  
          format: 'yyyy-MM-dd',  
          language: 'en',  
          pickDate: true,  
          pickTime: true,  
          hourStep: 1,  
          minuteStep: 15,  
          secondStep: 30,  
          inputMask: true  
        });
    $(document).ready(function() {
    	
      $('#menu_return').addClass('active').find('ul').addClass('in');
      	
   	 $("#del").click(function(){
       	alert("waerwerwee");
       });
   	 $("#query").click(function(){
   	    	alert("123");
   	    });
   	var dataTable =$('#example').dataTable( {
   		    "sDom": "<'row-fluid'<'span6'l><'span6'f>r>t<'row-fluid'<'span12'i><'span12 center'p>>",
   	        //"sPaginationType": "bootstrap",insert into return_order(status_code,create_date,order_type,creator,remark,transfer_order,distribution_order_id,contract_id
   	      "iDisplayLength": 10,
   	   	"bServerSide": true,
   	    	"oLanguage": {
   	            "sUrl": "/eeda/dataTables.ch.txt"
   	        },
   	      "sAjaxSource": "/yh/returnorder/list",
   			  "aoColumns": [
   				    { "mDataProp": "ORDER_NO"},
              { "mDataProp": "COMPANY_NAME"},
              { "mDataProp": "ORDER_TYPE", "bVisible": false},
              { "mDataProp": "TRANSFER_ORDER_NO"},
              { "mDataProp": "DELIVERY_ORDER_NO"},
              { "mDataProp": "CREATOR" },
              { "mDataProp": "CREATE_DATE" },
              { "mDataProp": "TRANSACTION_STATUS",
                  "fnRender": function(obj) {
                      if(obj.aData.TRANSACTION_STATUS=='new')
                          return '新建';
                      if(obj.aData.TRANSACTION_STATUS=='confirmed')
                          return '已确认';
                      if(obj.aData.TRANSACTION_STATUS=='cancel')
                          return '取消';
                      
                      return obj.aData.TRANSACTION_STATUS;
                   }
              },
              { "mDataProp": "REMARK" },
     	          { "mDataProp": null,
     	         		"sWidth": "8%", 
     	            "fnRender": function(obj) {                    
                   return "<a class='btn btn-success' href='/yh/returnorder/check/"+obj.aData.ID+"'>"+
                           "<i class='fa fa-search fa-fw'></i> "+
                           "查看"+
                       "</a>"+
                       "<a class='btn btn-danger cancelbutton' code='"+obj.aData.ID+"'>"+
                       "<i class='fa fa-trash-o fa-fw'></i> "+ 
                       "取消"+
                   "</a>";
     	         		}
     	 			    }
   	      ]
   	});
    $("#example").on('click', '.cancelbutton', function(e){
		  e.preventDefault();
       //异步向后台提交数据
		 var id = $(this).attr('code');
		$.post('/yh/returnorder/cancel/'+id,function(data){
               //保存成功后，刷新列表
               console.log(data);
               if(data.success){
              	 dataTable.fnDraw();
               }else{
                   alert('取消失败');
               }
           },'json');
		  });
   	 $("#btn").click(function(){
      	
   		alert("waerwerwee");
      
      		$("#routeItemFormDiv").show();
      
      		
     
      });
      $("#cancel").click(function(){
      	$("#routeItemFormDiv").hide();
      });
      $("#order_no ,#tr_order_no ,#de_order_no,#stator,#status,#time_one,#time_two").on( 'keyup click', function () {    	 	
      	var order_no = $("#order_no").val();
      	var tr_order_no = $("#tr_order_no").val();
    	var de_order_no = $("#de_order_no").val();
      	var stator = $("#stator").val();    	
      	var status = $("#status").val();
      	var time_one = $("#time_one").val();
      	var time_two = $("#time_two").val();
      	if (status=="新建") {
      		status ="new";
		}
		if (status=="确认") {
			status = "confirmed";
		}
		if (status=="取消") {
			status ="cancel";
		}
      	dataTable.fnSettings().sAjaxSource = "/yh/returnorder/list?order_no="+order_no+"&tr_order_no="+tr_order_no+"&de_order_no="+de_order_no+"&stator="+stator+"&status="+status+"&time_one="+time_one+"&time_two="+time_two;
      	dataTable.fnDraw();
      });

   });
   

    </script>




