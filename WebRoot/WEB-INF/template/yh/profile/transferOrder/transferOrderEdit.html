<%layout("/yh/layout.html"){%>
 

 <div id="page-wrapper">
    
    <div class="row">
        <div class="col-lg-12 panel-body">
            <% if(saveOK!''==true){%>
            <div class="alert alert-success alert-dismissable">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                保存成功。
            </div>
            <%}%>
            <h1 class="page-header">创建新运输单</h1>
           
        </div>
        <!-- /.col-lg-12 -->
    </div>

    <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            运输单基本信息
                        </div>
                        <div class="panel-body">
                            <div class="col-lg-8">
								<div class="form-group">
									<label >请选择客户</label>
									<div id="customers">
									</div>
								</div>
							</div>
                        </div>
                        <div class="panel-heading">
                       		<div id="customerFormDiv" style="display:none">
								<form id="customerForm" action="" method="post">
                            	 		<label>公司名称(必填)</label>
                                        <input id="company_name" name="company_name" type="text">
                            	 		<label>联系人(必填)</label>
                                        <input id="contact_person" type="text" name="contact_person">
                            	 		<label>联系地址</label>
                                        <input id="address" type="text" name="address">
                                        <label>联系人电话</label>
                                        <input id="disabledInput" type="text" name="phone">
                                        <label>email</label>
                                        <input id="email" type="text" name="email">
                                        <label>邮政编码</label>
                                        <input id="postal_code" type="text" name="postal_code">
                            	 		<a id="saveCustomerBtn" class="btn btn-default" href="#">保存</a>
   		             				<button class="btn btn-default" id="cancel">取消</button>
                           	 	</form>	
                           	 </div>
                   		</div>
                   		
                   		<div class="panel-body">
                            <div class="col-lg-8">
								<div class="form-group">
									<label >请选择收货人</label>
									<div id="contacts">
									</div>
								</div>
							</div>
                        </div>
                   		
                   		<div class="panel-heading">
                       		<div id="contactFormDiv" style="display:none">
								<form id="contactForm" action="" method="post">
                            	 		<label>公司名称(必填)</label>
                                        <input id="company_name" name="company_name" type="text">
                            	 		<label>联系人(必填)</label>
                                        <input id="contact_person" type="text" name="contact_person">
                            	 		<label>联系地址</label>
                                        <input id="address" type="text" name="address">
                                        <label>联系人电话</label>
                                        <input id="disabledInput" type="text" name="phone">
                                        <label>email</label>
                                        <input id="email" type="text" name="email">
                                        <label>邮政编码</label>
                                        <input id="postal_code" type="text" name="postal_code">
                                        <label>收货预约时间</label>
                                        <input id="eta" type="text" name="eta">
                            	 		<a id="saveCustomerBtn" class="btn btn-default" href="#">保存</a>
   		             				<button class="btn btn-default" id="cancel">取消</button>
                           	 	</form>	
                           	 </div>
                   		</div>
                   		
                   		<div class="panel-heading">
                       		<div id="radioFormDiv">
								<form id="radioForm" action="" method="post">
                            	 		<label>货品属性</label>
                            	 		<div>
	                                        <input id="cargo_nature_atm" name="cargo_nature" type="radio" value="cargo_nature_atm">ATM			
	                                        <input name="cargo_nature" type="radio" value="cargo_nature_common">普通货品			
	                                        <input name="cargo_nature" type="radio" value="cargo_nature_damaged">损坏货品
	                                    </div>
	                                    <div>
	                                        <input name="pickup_mode" type="radio" value="pickup_mode_service_provider">干线供应商自提		
	                                        <input name="pickup_mode" type="radio" value="pickup_mode_company">公司自提			
	                                        <input name="pickup_mode" type="radio" value="pickup_mode_outsourcer_service_provider">外包供应商提货
	                                    </div>
	                                    <div>
	                                        <input name="arrival_mode" type="radio" value="arrival_mode_direct">货品直送		
	                                        <input name="arrival_mode" type="radio" value="arrival_mode_transit_warehouse">入中转仓			
	                                    </div>
                            	 		<a id="saveRadioBtn" class="btn btn-default" href="#">保存</a>
   		             				<button class="btn btn-default" id="cancel">取消</button>
                           	 	</form>	
                           	 </div>
                   		</div>
                   		
                   		<div class="panel-heading">
                     		<div><h4>货品明细</h4></div>
                       		<div id="itemFormDiv">
								<form id="itemForm" action="" method="post">
                            	 		<label id="label_item_no" style="display:none">ATM序列号</label>
                                        <input id="item_no" type="text" name="item_no" style="display:none">
                            	 		<label>货品名称</label>
                                        <input id="item_name" type="text" name="item_name">
                            	 		<label>货品描述</label>
                                        <input id="item_desc" type="text" name="item_desc">
                                        <label>数量</label>
                                        <input id="amount" type="text" name="amount">
                                        <label>单位</label>
                                        <input id="unit" type="text" name="unit">
                                        <label>体积</label>
                                        <input id="volume" type="text" name="volume">
                                        <label>重量</label>
                                        <input id="weight" type="text" name="weight">
                                        <label>备注</label>
                                        <input id="remark" type="text" name="remark">
                            	 		<a id="saveItemBtn" class="btn btn-default" href="#">保存</a>
   		             				<button class="btn btn-default" id="cancel">取消</button>
                           	 	</form>	
                           	 </div>
                   		</div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->      
</div>
			
	<!--/span-->


<!--/row-->

<!-- content ends -->
<%}%>
<!-- 引入校验的js 文件及其 中文 文件-->
<script src="/eeda/js/jquery.validate.min.js"></script>
<script src="/eeda/js/jvalidate.messages_cn.js"></script>
<script>
    $(document).ready(function() {
    	// 动态显示客户(单选按钮)
       	var customer =$("#customers");
       	customer.empty();
       	$.get('/yh/transferOrder/selectCustomer',{},function(data){
			for(var i = 0; i < data.length; i++)
			{
				customer.append("<input id='"+data[i].ID+"' type='radio' name='customer_id' />"+data[i].ID+" - "+data[i].COMPANY_NAME+" - "+data[i].CONTACT_PERSON+" - "+data[i].ADDRESS+" - "+data[i].MOBILE+" / "+data[i].PHONE +"</br>");
			}
			customer.append("<input id='newCustomer' type='radio' name='customer_id' />"+"使用新地址");
		},'json');
       	
       	// 单击选中单选按钮,触发事件,控制form的显示与隐藏
       	$("#customers").click(function(){
       		var ins = $("#customers input[id]");
       		for(var i=0;i<ins.length;i++){
       			if(i == ins.length-1){
       				$("#customerFormDiv").show();       				
       			}else{
       				$("#customerFormDiv").hide();
       			}
       		}
       	});
       	
      	//点击保存的事件，保存客户信息
        //customerForm 不需要提交
        $("#saveCustomerBtn").click(function(e){
            //阻止a 的默认响应行为，不需要跳转
            e.preventDefault();
            //异步向后台提交数据
            $.post('/yh/transferOrder/saveCustomer', $("#customerForm").serialize(), function(data){
                 //保存成功后，刷新列表
                 console.log(data);
                 if(data.success){
                 	dataTable.fnDraw();
                 }else{
                     alert('数据保存失败。');
                 }                    
             },'json');
        });

    	// 动态显示联系人(单选按钮)
       	var contact =$("#contacts");
       	contact.empty();
       	$.get('/yh/transferOrder/selectContact',{},function(data){
			for(var i = 0; i < data.length; i++)
			{
				contact.append("<input id='"+data[i].ID+"' type='radio' name='customer_id' />"+data[i].ID+" - "+data[i].COMPANY_NAME+" - "+data[i].CONTACT_PERSON+" - "+data[i].ADDRESS+" - "+data[i].MOBILE+" / "+data[i].PHONE +"</br>");
			}
			contact.append("<input id='newCustomer' type='radio' name='customer_id' />"+"使用新地址");
		},'json');
       	
       	// 单击选中单选按钮,触发事件,控制form的显示与隐藏
       	$("#contacts").click(function(){
       		var ins = $("#contacts input[id]");
       		for(var i=0;i<ins.length;i++){
       			if(i == ins.length-1){
       				$("#contactFormDiv").show();       				
       			}else{
       				$("#contactFormDiv").hide();
       			}
       		}
       	}); 
       	
       	// 当货品属性位ATM时,增加ATM的序列号
       	$("#cargo_nature_atm").click(function(){
       		$("#label_item_no").show()
       		$("#item_no").show()
       	});
    })
</script>
