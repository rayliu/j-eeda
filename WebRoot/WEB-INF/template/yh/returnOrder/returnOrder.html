<%layout("/yh/layout.html"){%>
<link href="/yh/js/plugins/sco/css/sco.message.css" rel="stylesheet">
        <div id="page-wrapper">
            <div class="row">
           
                <div class="col-lg-12">
                    <div class="btn-header" style="font-size: 32px">回单</div>                  
                    <input type="hidden" id="returnId" value="${returnOrder.id!''}">
                    <input type="hidden" id="returnStatus" value="${returnOrder.transaction_status!''}">
                    <input type="hidden" id="transferOrderId" value="${transferOrder.id!''}">
                    <input type="hidden" id="deliveryOrderId" value="${returnOrder.delivery_order_id!''}">
                    
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        
                        <!-- /.panel-heading -->
                        <div class="panel-body" id="total">
                       
                         <%if(saveOK!''==true){%>  
		    <div class="alert alert-success">
              <button type="button" class="close" data-dismiss="alert">×</button>
             	 保存成功
            </div>
		    <%}%>
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs">
                                <li class="active"><a href="#basic" data-toggle="tab" id = "chargeCheckOrderbasic">基本信息</a>
                                </li>
                                <li class=""><a href="#cargos" data-toggle="tab" id = "returnOrderItemList">货品明细</a>
                                </li>
                                <li class=""><a href="#arap" data-toggle="tab" id = "returnOrderPayment">应收</a>
                                </li>
                                <li class=""><a href="#sign" data-toggle="tab" id = "signPicture">签收图片</a>
                                </li>
                            </ul>

                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div class="tab-pane fade active in" id="basic">
                                <div class="row">
                                <img alt="" src="">
                               <div class="col-lg-6">
                                <input class="form-control" id="snature" type="hidden" >
                                    <form role="form" method="post" action="" id="returnOrderForm">
                                     <input type="hidden" name="id" id="returnOrderid" value="${returnOrder.id}">
                                    
                                   		  <h2>回单信息</h2>  
                                   		  <div class="form-group">
                                             <label>回单号</label>
                                             <label class="radio-inline"></label><strong>${returnOrder.order_no!''}</strong>
                                          </div>
                                          <div class="form-group" id="status">
                                             <label>状态</label>
                                             <label class="radio-inline"></label>
                                             <span id="sp_status"></span>
                                          </div>  
                                          <div class="form-group">
                                              <label>回单创建人</label>
                                              <label class="radio-inline"></label><%if(userLogin.c_name!''==''){ %>${userLogin.user_name!''}<%}else{%>${userLogin.c_name!''}<%}%>
                                          </div>                                                                               
                                          <div class="form-group">
                                              <label>回单创建时间</label>
                                              <label class="radio-inline"></label>${returnOrder.create_date!''}
                                          </div>
                                        
                                        <h2>客户信息</h2>  
                                         <div class="form-group">
                                            <label>公司名称</label>	${customerContact.company_name!''}
                                        </div>
                                        <div class="form-group">
                                            <label>地址</label>	${customerContact.address!''}
                                        </div>                                                                               
                                        <div class="form-group">
                                            <label>联系人</label>	${customerContact.contact_person!''}
                                        </div>                                        
                                        <div class="form-group">
                                            <label>电话</label>	${customerContact.phone!''}
                                        </div>
                                        <div id="customer_deliver_no">  
	                                        <div class="form-group">
	                                            <label>客户配送单号</label> 
	                                            <input name="customer_delivery_no" value="${deliveryOrder.customer_delivery_no!''}" class="form-control">	
	                                        </div>
	                                    </div>
                                        <input id="locationChanged" name='locationChanged' type="hidden" value="false"/>
                                        <div id="contactInformation">
    	                                        <h2>收货人信息</h2>
    	                                        <div class="form-group">
    	                                            <label>收货人公司名称</label>
    	                                            <input name="company_name" value="${transferOrder.receiving_unit!''}" class="form-control" placeholder="请输入收货地址">
    	                                        </div>
    	                                        <div class="form-group">
    	                                            <label>收货地址</label>
    	                                            <input name="address" value="${contact.address!''}" class="form-control" placeholder="请输入收货地址">
    	                                        </div>
    	                                        <div class="form-group">
    	                                            <label>联系人</label>
    	                                            <input name="contact_person" value="${contact.contact_person!''}" class="form-control" placeholder="请输入联系人">
    	                                        </div>
    	                                        <div class="form-group">
    	                                            <label>电话</label>
    	                                            <input name="phone" value="${contact.phone!''}" class="form-control" placeholder="请输入电话">
    	                                        </div>
                                            </div>
                                    </div>
                                    
                                <!-- /.col-lg-6 (nested) -->
                                <div class="col-lg-6">
	                                <div class="form-group">
	                                   <h2>运输信息</h2> 
	                                    </div> 
	                      					<div class="form-group">
	                                        <label>单号</label>	<strong>${transferOrder.order_no!''}</strong>
	                                    </div> 
	                                                                            
	                                    <div class="form-group">
	                                     <label >业务员</label>  ${userLoginTo.c_name!''}                                    
	                                    </div>
	                                    <div class="form-group">
	                                        <label>货品属性</label>	<span id="cargoNatureSpan"><input id="cargoNature" type="hidden" value="${transferOrder.cargo_nature!''}"></span>
	                                    </div>
	                                    <div class="form-group">
	                                        <label>提货方式</label>	<span id="pickupModeSpan"><input id="pickupMode" type="hidden" value="${transferOrder.pickup_mode!''}"></span>                                        
	                                    </div>                                        
                                        <div class="form-group">
                                            <label>到达方式</label>	<span id="arrivalModeSpan"><input id="arrivalMode" type="hidden" value="${transferOrder.arrival_mode!''}"></span>                                            
                                        </div>                                         
	                                    <h2>路线</h2>
	                                   			 <div class="form-group">
	                                           		<label>始发地</label>	${locationFrom.province!''} ${locationFrom.city!''} ${locationFrom.district!''}                              
	                                       			 </div>       
	                                              <!-- <div class="form-group">                                        
	                                              	<label>终点</label>		${locationTo.province!''} ${locationTo.city!''} ${locatioTo.district!''}      
	                                 			</div>  --> 
	                                 			<div class="form-group" >
	                                            <input id="locationTo" type="hidden" name="route_to" value="${departOrder.route_to!''}">
	                                           	<label>目的地</label>
			                                     <div class="form-control" style="padding: 0px 0px;box-shadow:none;border:none;height:35px;">       
			                                        <label>省</label>
			                                        <input id="hideProvinceTo" type="hidden" value="${locationTo.province!''}"/>
			                                        <select id="mbProvinceTo" class="valid" name="mbProvinceTo" value=""></select>
			                                        <label>市</label>
			                                        <input id="hideCityTo" type="hidden" value="${locationTo.city!''}"/>
			                                        <select  id="cmbCityTo"  class="valid" name="cmbCityTo" value=""></select>
			                                        <label>区(县)</label>
			                                        <input id="hideDistrictTo" type="hidden" value="${locationTo.district!''}" />
			                                        <select  id="cmbAreaTo" class="valid" name="cmbAreaTo" value=""></select>
			                                    	</div>
			                                    </div>
	                                 			<div class="form-group">
	                                            <label>备注</label>
	                                            <textarea class="form-control" rows="6" name="remark">${returnOrder.remark!''}</textarea>
	                                        </div> 
	                                      
	                                </div>

                                </form>
                                <!-- /.col-lg-6 (nested) -->
                            </div>
                         </div>
                                <div class="tab-pane fade" id="cargos">
                                    <div class="panel-body">             
                                        <div class="table-responsive">
			                                <br/>   
			                                <table class="table table-striped table-bordered table-hover" id="transferOrderTable">
			                                    <thead>
			                                        <tr>
			                                        	<th>序列号</th>
			                                            <th>型号</th>
	                                                    <th>名称</th>
	                                                    <th>长(mm)</th>
	                                                    <th>宽(mm)</th>
	                                                    <th>高(mm)</th>
	                                                    <th>重量(kg)</th>
	                                                    <th>数量</th>
	                                                    <th>件数</th>
	                                                    <th>单位</th>
	                                                    <th>总重量(kg)</th>
	                                                    <th>总体积(m³)</th>                                  
	                                                    <th>备注</th>
			                                        </tr>
			                                    </thead>
			                                    <tbody>                                        
			                                    </tbody>
			                                </table>
			                                <div style="display: none" id="transferOrderItemDateil">
	                                            <h3 class="btn-header">单品列表</h3>
												<input type="hidden" id="item_id" name="item_id" />
	                                            <table class="table table-striped table-bordered table-hover" id="detailTable">
	                                                <thead>
	                                                    <tr>	                                                        
	                                                        <th>序列号</th>
	                                                        <th>型号</th>
	                                                        <th>名称</th>
	                                                        <th>体积</th>
	                                                        <th>重量</th>
	                                                        <th>收货人</th>
	                                                        <th>电话</th>
	                                                        <th>地址</th>
	                                                        <th>备注</th>
	                                                        <th></th>
	                                                    </tr>
	                                                </thead>
	                                                <tbody id="transferOrderItemDetailTbody">
	                                                </tbody>
	                                            </table>
                                            </div>
			                            </div>
                                    </div>                              
                            </div>
                            
                                <div class="tab-pane fade" id="arap">
                                    <!-- <h2>应收</h2> -->
                                    
                                    <input type="hidden" id="receivableTotal" value="${receivableTotal!''}">
                                    <div class="panel-body">
                                    	<button class="btn  btn-primary" id="addrow2">添加应收</button>
                                        <div class="table-responsive">
                                            <table class="table table-striped table-bordered table-hover" id ="table_fin">
                                                <thead>
                                                    <tr>
                                                        <th>客户</th>
                                                        <th>运输单号</th>
                                                        <th>配送单号</th>
                                                        <th>费用条目</th>
                                                        <th>金额</th>
                                                        <th>备注</th>
                                                        <th>结算状态</th>
                                                        <th>费用来源</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                   
                                                </tbody>
                                                <div id="receivableItemList" style="display:none;">
	                                            	<%for(receivableItem in receivableItemList){ %>
   														<option value='${receivableItem.ID!''}'>${receivableItem.NAME!''}</option>
	   												<%		
	   													}
	   												%>
                                            	</div>
                                            </table>
                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>
                                    <!-- /.panel-body -->
                                    
                                </div>     
                                
                                <div class="tab-pane fade" id="sign">
                                    <div class="panel-body">             
                                        <div class="row">
                                        	<input type="hidden" id="files" name="files" value="${files!''}">
									  		<div class="col-lg-12" style="clear:both;">
									  			<div class="form-group"> 
										  			<input id="savefile" type="button" class="btn  btn-primary" value="上传图片"><p>(图片格式为：gif,jpeg,png,jpg)</p>
		                                        	<form method="post" id="fileForm" action="/returnOrder/saveFile" enctype="multipart/form-data">
		                                            	<input type="hidden" id="return_id" name="return_id" value="${returnOrder.id!''}">
		                                                <input type="file" id="fileupload" name="fileupload" accept="image/GIF,image/gif,image/JPEG,image/jpeg,image/PNG,image/png,image/JPG,image/jpg"
													     style="position:absolute; filter:alpha(opacity=0); opacity:0; width:30px; " size="1" multiple>
		                                            </form >
	                                            </div>
	                                    	</div>
		                                    <div class="col-lg-12" style="clear:both;" id="showPictures">
		                                    	<%for(orderAttachmentFile in OrderAttachmentFileList){ %>
		                                    		<div style="width:200px;height:210px;float:left;" ><img src="/upload/fileupload/${orderAttachmentFile.FILE_PATH!''}" alt="" class="imgSign" style="width:180px;height:180px;"><p><a class="picturedel" picture_id="${orderAttachmentFile.ID!''}" >删除</a></p></div>
   												<%		
   													}
   												%>
		                                    </div>
										</div>
                                    </div>                              
                            	</div>
                            	
                            	<div class="panel-heading">
	                                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false" data-backdrop="static">
	                                  <div class="modal-dialog">
	                                    <div class="modal-content">
	                                        <div class="modal-body" align="center">
	                                        	<center id="centerBody">
	                                            	<img src="/yh/image/loading5.gif" width="20%">
	                                            	<h4>上传过程可能需要一点时间，请勿退出页面！</h4>
	                                            </center>
	                                        </div>
	                                        <div class="modal-footer" id="footer" aria-hidden="true">
									        	<button type="button" class="btn  btn-primary" data-dismiss="modal" id="cancel">关闭</button>
									      	</div>
	                                    </div>
	                                  </div>
	                                </div>
	                            </div>
                            	
                            	<div class="panel-heading">
                            		<div class="modal fade bs-example-modal-lg" id="myModal_img" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
	                                  <div class="modal-dialog modal-dialog modal-lg"  id="imgContent">
	                                    <div class="modal-content">
	                                    	<div class="modal-header">
											     <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
											     <h4 class="modal-title" id="myModalLabel">&nbsp;</h4>
										    </div>
	                                        <div class="modal-body" align="center" id="lgImgDiv">
	                                        	<img src="" />
	                                        </div>
	                                    </div>
	                                  </div>
	                                </div>
	                            </div>
                            	
                                <div class="form-group"><hr/>
                        			<a style="display:none" id ="style"><i class='fa fa-check'></i></a>
                        			<% if(shiro.hasPermission("ReturnOrder.update")){%>
                                	<button id="saveReturnOrderBtn" type="button" class="btn  btn-primary" data-toggle="tooltip" title="" data-original-title="Default tooltip">保存</button> 
                                	<%}%>
                                	<% if(shiro.hasPermission("ReturnOrder.completed")){%>
                                	<button id="returnOrderAccomplish" type="button" class="btn  btn-primary" data-toggle="tooltip" title="" data-original-title="Default tooltip">回单签收</button> 
                                	<%}%>
                                </div>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->

            </div>
        </div>
        <!-- /#page-wrapper -->

<%}%>
<%
	var title=SYS_CONFIG.system_title!'';
%>
<script src="/yh/js/plugins/jQuery-File-Upload-9.5.7/jquery.ui.widget.js"></script>
<script src="/yh/js/plugins/jQuery-File-Upload-9.5.7/jquery.iframe-transport.js"></script> 
<script src="/yh/js/plugins/jQuery-File-Upload-9.5.7/jquery.fileupload.js"></script>
<script src="/yh/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="/yh/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="/yh/js/jquery.validate.min.js"></script>
<script src="/yh/js/jvalidate.messages_cn.js"></script>
<script src="/yh/js/returnOrder/edit.js"></script>
<script src="/yh/js/plugins/sco/js/sco.message.js"></script>