<%layout("/yh/layout.html"){%>
<link href="/yh/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
<link rel="stylesheet" href="/yh/css/ui/jquery-ui.css">
<link href="/yh/js/plugins/sco/css/sco.message.css" rel="stylesheet">
<link href="/yh/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <div class="btn-header"style="font-size: 32px">应收对账单</div><input id="order_id" type="hidden" name="order_id"/>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <!-- Nav tabs -->
                            <ul id="orderTabs" class="nav nav-tabs">
                                <li class="active"><a href="#basic" data-toggle="tab" data-src="basic" id ="chargeCheckOrderbasic" >基本信息</a>
                                </li>
                                <li class=""><a href="#arap" data-toggle="tab" id="chargeCheckOrderItem">应收明细</a>
                                </li>                               
                                <li class="" style="display:none;"><a href="#cargos" data-toggle="tab" id="chargeMiscList">扣款明细</a>
                                </li>
                                <li class="" style="display:none;"><a href="#milestone" data-toggle="tab" id="transferOrderMilestoneList">里程碑</a>
                                </li> 
                            </ul>

                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div class="tab-pane fade active in" id="basic">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <form role="form" id="chargeCheckOrderForm">
                                        	<input id="chargeCheckOrderId" type="hidden" name="chargeCheckOrderId" value="${arapAuditOrder.id!''}"/>
                                        	<input id="customer_id" type="hidden" name="customer_id" value="${party.id!''}"/>
                                        	<input type="hidden" id="returnOrderIds" name="returnOrderIds" value="${returnOrderIds!''}"/>
                                        	<input type="hidden" id="miscOrderIds" name="miscOrderIds" value="${miscOrderIds!''}"/>
                                        	<input type="hidden" name="order_no" value="${order_no!''}${arapAuditOrder.order_no!''}"/>
                                        	<input type="hidden" name="status" value="${status!''}${arapAuditOrder.status!''}"/>
                                        	<input type="hidden" name="create_by" value="${create_by!''}${arapAuditOrder.create_by!''}"/>
                                        	<input type="hidden" name="beginTime" value="${beginTime!''}${arapAuditOrder.beginTime!''}"/>
                                        	<input type="hidden" name="endTime" value="${endTime!''}${arapAuditOrder.endTime!''}"/>
                                        	<input type="hidden" name="spId" id="spId" value="${spId!''}"/>
                                            <input type="hidden" name="addMiscOrder" id="addMiscOrder" value=""/>
                                            <input type="hidden" name="addReturnOrder" id="addReturnOrder" value=""/>
                                            <input type="hidden" name="addAmount" id="addAmount" value=""/>
                                            <input type="hidden" name="initialAmount" id="initialAmount" value=""/>
                                            <input type="hidden" name="initialTotalAmount" id="initialTotalAmount" value=""/>
                                            <input type="hidden" name="initialChargeAmount" id="initialChargeAmount" value=""/>
                                            <input type="hidden" name="closeId" id="closeId" value=""/>
                                            <input type="hidden" name="customer_name" id="customer_name" value="${customer.abbr!''}"/>
                                        	<input type="hidden" name="total_amount" value="${totalAmount!''}${arapAuditOrder.total_amount!''}"/>
                                        	<input type="hidden" id="hiddenDebitAmount" name="debit_amount" value="${debitAmount!''}${arapAuditOrder.debit_amount!''}"/>
                                            <h3>客户信息</h3>
                                            <div class="form-group">
                                                <label>公司名称</label>
                                                <label class="radio-inline" id="company">${customer.company_name!''}</label>
                                            </div>
                                            <div class="form-group">
                                                <label>地址</label>
                                                <label class="radio-inline" id="company">${customer.address!''}</label>
                                            </div>
                                            <div class="form-group">
                                                <label>联系人</label>
                                                <label class="radio-inline" id="company">${customer.contact_person!''}</label>
                                            </div>
                                            <div class="form-group">
                                                <label>电话</label>
                                                <label class="radio-inline" id="company">${customer.phone!''}</label>
                                            </div>
                                            <div><label>应收总金额:</label><label class="radio-inline" id="amount" style="font-weight:bold;">${totalAmount!''}${arapAuditOrder.total_amount!''}</label></div>
                                            <div><label>扣款金额</label><label class="radio-inline" id="debitAmount" style="font-weight:bold;">${arapAuditOrder.debit_amount!''}</label></div>
                                            <div><label>对账确认金额</label><label class="radio-inline" id="chargeAmount" style="font-weight:bold;">${totalAmount!''}${arapAuditOrder.charge_amount!''}</label></div>
                                            
                                            <div class="form-group">
                                                <label>备注</label>
                                                <textarea class="form-control" rows="7" name="remark" id="remark">${arapAuditOrder.remark!''}</textarea>
                                            </div>                               
                                    </div>
                                    <!-- /.col-lg-6 (nested) -->
                                    <div class="col-lg-4">
                                    <h3>对账单信息</h3>
                                    <div class="form-group">
                                        <label>对账单号</label> <strong id = "arap_order_no">${order_no!''}${arapAuditOrder.order_no!''}</strong>
                                    </div>
                                    <div class="form-group">
                                        <label>单据状态</label>   <span  id="chargeCheckOrderStatus">${status!''}${arapAuditOrder.status!''}</span>
                                    </div>
                                    <div class="form-group">
                                        <label>创建人</label>  <%if(userLogin.c_name!''==''){ %>${userLogin.user_name!''}<%}else{%>${userLogin.c_name!''}<%}%>                                  
                                    </div>		         
                                        <div class="form-group">                                        
                                            <div id="datetimepicker" class="input-append date "> 
                                                <label class="search-label">对账开始时间</label> 
                                                <input id="beginTime_filter" class="form-control search-control  beginTime_filter" type="text" name="beginTime_filter" value="${arapAuditOrder.begin_time!''}">
                                                <span class="add-on">  
                                                    <i class="fa fa-calendar" data-time-icon="icon-time" data-date-icon="icon-calendar"></i>  
                                                </span>  
                                            </div>     
	                                        <div class="form-group">                                                    
	                                            <span id="datetimepicker2" class="input-append date search-control "> 
	                                                <label class="search-label">对账结束时间</label> 
	                                                <input id="endTime_filter" class="form-control search-control endTime_filter" type="text" name="endTime_filter" value="${arapAuditOrder.end_time!''}">
	                                                <span class="add-on">  
	                                                    <i class="fa fa-calendar" data-time-icon="icon-time" data-date-icon="icon-calendar"></i>  
	                                                </span>  
	                                            </span>
	                                        </div>
		                                </div>
		                                <div class="form-group">
                                            <label class="label-margin">是否开票</label>
                                           	<input id="invoiceRadio" type="hidden" value="${arapAuditOrder.have_invoice!''}"/>
                                           	<label class="radio-inline">
                                                <input type="radio" name="invoiceType" id="salesOrder" value="Y" checked="checked">是
                                            </label>
                                           	<label class="radio-inline">
                                                <input type="radio" name="invoiceType" id="replenishmentOrder" value="N">否
                                            </label>
                                        </div>
                                        <div id ="isInvoice">
                                            <%include("/yh/component/form/inputField.html",{id:'billing_unit', label:'开票单位' ,value:arapAuditOrder.billing_unit!customer.company_name!'' }){} %>
	                                        <%include("/yh/component/form/inputField.html",{id:'payee', label:'收&nbsp;&nbsp;款&nbsp;&nbsp;人' ,value:arapAuditOrder.payee!'' }){} %>
                                        </div>
                                        <!-- end of row-->                                        
                                    </form>    
                                    
                                   <!--  <h2>时间段</h2>
                                    <form role="form">
                                        <div class="form-group">
                                            <input type="text" class="form-control input-inline input-large" id="beginTime" value="${beginTime!''}"> - <input type="text" class="form-control input-large input-inline" id="endTime" value="${endTime!''}">
                                        </div>
                                    </form> -->
                                </div>
                                <!-- /.col-lg-6 (nested) -->
                            </div>
                         </div>
                                <div class="tab-pane fade" id="milestone">
                                    <div class="panel-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-bordered table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        <th>状态</th>
                                                        <th>地点</th>
                                                        <th>更新用户</th>
                                                        <th>更新时间</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="transferOrderMilestoneTbody" >
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>
                                    <!-- /.panel-body -->
                                </div>
                                <div class="tab-pane fade" id="arap">
                                	<div class="panel-body">
                                		<div class="row">
		                                    <div class="col-lg-4">
		                                    	<div class="form-group">
		                                            <label class="search-label">序列号</label>
		                                            <input type="text" class="form-control search-control serial_no_filter" id="serial_no_filter" name="serial_no_filter">
		                                        </div>
		                                    </div>
		                                     <div class="col-lg-4">
		                                    	<div class="form-group">
		                                            <label class="search-label">签收单号</label>
		                                            <input type="text" class="form-control search-control ref_no_filter" id="ref_no_filter" name="ref_no_filter">
		                                        </div>
		                                    </div>
		                                    <div class="col-lg-4">
		                                    	<div class="form-group">
		                                            <label class="search-label">客户订单号</label>
		                                            <input type="text" class="form-control search-control customerNo_filter" id="customerNo_filter" name="customerNo_filter">
		                                        </div>
		                                    </div>
		                                    <div class="col-lg-4">
		                                        <button id="searchBtn" class="btn  btn-primary">查询</button>
		                                    </div>
		                                    
	                                    </div>
	                                    <div class="row">
	                                    	<div class="col-lg-4">
		                                		<label>对账确认金额:</label><label class="radio-inline" id="total_amount">${totalAmount!''}${arapAuditOrder.charge_amount!''}</label>
		                                        <button id="addOrderBtn" class="btn  btn-primary" disabled="true" data-toggle="modal" data-target="#addOrder" data-backdrop="static">
		                                         	   加入单据
		                                        </button>
		                                    </div>
	                                    </div>
                                        <div class="table-responsive">
			                                <table class="table table-striped table-bordered table-hover" id="chargeConfirem-table" style="width: 2200px;">
			                                    <thead>
			                                        <tr>
                                                        <th></th>
                                                        <th></th>
                                                        <th></th>
			                                            <th>回单号/收入单号</th>
			                                            <th>收入状态</th>
                                                        <th>合计收入</th>
                                                        <th>对账确认金额</th>
                                                        <th>计划时间</th>
                                                        <th>序列号</th>
                                                        <th>签收单号</th>
                                                        <th>省份</th>
                                                        <th>客户订单号</th>
                                                        <th>目的地</th>
			                                            <th>客户名称</th>
			                                            <th>收货地址</th>
			                                            <th>供应商名称</th>
			                                            <th>发车时间</th>
			                                            <th>运输单号</th>
			                                            <th>配送单号</th>
			                                            <th>订单状态</th>
			                                            <th>回单时间</th>
			                                            <th>始发地</th>
			                                            <!-- <th>结算数量？</th>
			                                            <th>单价？</th> -->
			                                            <th>合同运费</th>
			                                            <th>提货费</th>
			                                            <th>送货费</th>
			                                            <th>保险费</th>
			                                            <th>超里程费</th>
			                                            <th>台阶费</th>
			                                            <th>安装费</th>
			                                            <th>装卸费</th>
			                                            <th>仓租费</th>
			                                            <th>等待费</th>
			                                            <th>其他费用</th>
			                                            <th>备注</th>
                                                        <th>操作</th>
			                                        </tr>
			                                    </thead>
			                                    <tbody>
			                                        <%
                                                    for(item in itemList){ %>
                                                        <tr class="odd" id="${item.ID!''}" order_type="${item.TPORDER!''}">
                                                            <td class="">${item.ID!''}</td>
                                                            <td class="">${item.TPORDER!''}</td>
                                                            <td class="">${item.CREATOR!''}</td>
                                                            <td class="">${item.ORDER_NO!''}</td>
                                                            <td class=""></td>
                                                            <td class="">${item.CHARGE_TOTAL_AMOUNT!''}</td>
                                                            <td class="">${item.CHANGE_AMOUNT!''}</td>
                                                            <td class="">${item.PLANNING_TIME!''}</td>
															<td class="">${item.SERIAL_NO!''}</td>
															<td class="">${item.REF_NO!''}</td>
                                                            <td class="">${item.PROVINCE!''}</td>
                                                            <td class="">${item.CUSTOMER_ORDER_NO!''}</td>
                                                            <td class="">${item.ROUTE_TO!''}</td>
                                                            <td class="">${item.CNAME!''}</td>
                                                            <td class="">${item.RECEIPT_ADDRESS!''}</td>
                                                            <td class="">${item.SP!''}</td>
                                                            <td class=""></td>
                                                            <td class="">${item.TRANSFER_ORDER_NO!''}</td>
                                                            <td class="">${item.DELIVERY_ORDER_NO!''}</td>
                                                            <td class="">${item.TRANSACTION_STATUS!''}</td>
                                                            <td class="">${item.RECEIPT_DATE!''}</td>
                                                            <td class="">${item.ROUTE_FROM!''}</td>
                                                            <td class="">${item.CONTRACT_AMOUNT!''}</td>
                                                            <td class=""></td>
                                                            <td class=""></td>
                                                            <td class="">${item.INSURANCE_AMOUNT!''}</td>
                                                            <td class=""></td>
                                                            <td class=""></td>
                                                            <td class="">${item.STEP_AMOUNT!''}</td>
                                                            <td class=""></td>
                                                            <td class=""></td>
                                                            <td class="">${item.WAREHOUSE_AMOUNT!''}</td> 
                                                            <td class=""></td>
                                                            <td class=""></td>
                                                            <td class=""><a class='btn btn-danger finItemdel' code='"+${item.ID!''}+"' change_amount='"+${item.CHANGE_AMOUNT!''}+"' order_type='"+${item.tporder!''}+"' ><i class='fa fa-trash-o fa-fw'> </i>删除</a></td>
                                                        </tr>
                                                    <% }%>
			                                    </tbody>
			                                </table>
                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>
                                    <!-- /.panel-body -->
								</div>
                                <div class="modal fade" id="addOrder" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                  <div class="modal-dialog" style="width:80%;">
                                    <div class="modal-content">
                                      <div class="modal-header">
                                        <h4 class="modal-title" id="myModalLabel">手工单</h4>
                                      </div>
                                      <div class="form-group">
                                        <label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;回单号:</label>
                                        <input type="text" class="form-control search-control status_filter" style="" id="ref_no">
                                      </div>
                                      <div class="form-group">
                                        <label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;客&nbsp;&nbsp;&nbsp;&nbsp;户:</label>
                                        <input type="text" class="form-control search-control status_filter"  disabled="true" style="" id="customer_no">
                                      </div>
                                      <div class="modal-body">
                                        <form id="addOrderForm" action="">
                                            <div class="tab-pane fade active in" id="unchecked">
                                                        <div class="table-responsive datatable-scroll">
                                                            <table class="table table-striped table-bordered table-hover" id="uncheckedChargeCheck-table" style="width: 2800px;">
                                                                <thead>
                                                                    <tr>
                                                                        <th><!-- <input type="checkbox" id="allCheck" name="allCheck"> --></th>
                                                                        <th></th>
                                                                        <th>回单号</th>
                                                                        <th>收入状态</th>
                                                                        <th>合计收入</th>
                                                                        <th>客户名称</th>
                                                                        <th>供应商名称</th>
                                                                        <th>计划时间</th>
                                                                        <th>收货地址</th>
                                                                        <th>发车时间</th>
                                                                        <th>运输单号</th>
                                                                        <th>配送单号</th>
                                                                        <th>客户订单号</th>
                                                                        <th>订单状态</th>
                                                                        <th>回单时间</th>
                                                                        <th>始发地</th>
                                                                        <th>目的地</th>
                                                                        <th>合同运费</th>
                                                                        <th>提货费</th>
                                                                        <th>送货费</th>
                                                                        <th>保险费</th>
                                                                        <th>超里程费</th>
                                                                        <th>台阶费</th>
                                                                        <th>安装费</th>
                                                                        <th>装卸费</th>
                                                                        <th>仓租费</th>
                                                                        <th>等待费</th>
                                                                        <th>其他费用</th>
                                                                        <th>合计成本</th>
                                                                        <th>收货地址</th>
                                                                        <th>确认人</th>
                                                                        <th>确认时间</th>
                                                                        <th>备注</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="uncheckedChargeCheckList">
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        </div>
                                          <div class="modal-footer">
                                          <br>
                                            <button id="closeExternalFormBtn" type="button" class="btn  btn-primary" data-dismiss="modal">取消</button>
                                            <button id="addOrderFormBtn" type="button" class="btn  btn-primary">保存</button>
                                          </div>
                                        </form>
                                      </div>
                                    </div><!-- /.modal-content -->
                                  </div><!-- /.modal-dialog -->
                                </div>
                                <div class="tab-pane fade" id="cargos">
                                    <div class="panel-body">
                                    <div>
	                                    <button id="addExternalMiscOrderBtn" class="btn  btn-primary" data-toggle="modal" data-target="#addExternalMiscOrder" data-backdrop="static">
											选择应收扣款单
										</button>
									</div>
                                	<label>扣款金额</label>
                                    <label class="radio-inline" id="debitAmountSpan">${arapAuditOrder.debit_amount!''}</label>
                                        <div class="table-responsive">
			                                <table class="table table-striped table-bordered table-hover" id="chargeMiscList-table">
			                                    <thead>
			                                        <tr>
			                                            <th>扣款单号</th>
			                                            <th>客户名称</th>
			                                            <th>应收条目</th>
			                                            <th>金额</th>
			                                            <th>备注</th>  
			                                        </tr>
			                                    </thead>
			                                    <tbody>
			                                                                                                                                            
			                                    </tbody>
			                                </table>
                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>
                                    <!-- /.panel-body -->
								</div>
								
								<!-- 模态框 -->
								<div class="modal fade" id="addExternalMiscOrder" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
								  <div class="modal-dialog">
								    <div class="modal-content">
								      <div class="modal-header">
								        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								        <h4 class="modal-title" id="myModalLabel">选取手工单</h4>
								      </div>
								      <div class="modal-body">
								      	<form id="addExternalTransferOrderForm" action="">
								      		<input type="hidden" name="micsOrderIds" id="micsOrderIds"/>
								      		<div class="table-responsive">
				                                <table class="table table-striped table-bordered table-hover" id="external-table">
				                                    <thead>
				                                        <tr>
			                                            	<th></th>
				                                            <th>手工收款单号</th>
				                                            <th>类型</th>
				                                            <th>状态</th>
				                                            <th>创建时间</th>
				                                            <th>对账单号</th>
				                                            <th>备注</th>                                       
				                                         </tr>
				                                    </thead>
				                                    <tbody>                                        
				                                    </tbody>
				                                </table>
				                            </div>
										      <div class="modal-footer">
											      <br>
											        <button id="closeExternalFormBtn" type="button" class="btn  btn-primary" data-dismiss="modal">取消</button>
											        <button id="addExternalFormBtn" type="button" class="btn  btn-primary">保存</button>
										      </div>
										</form>
									  </div>
								    </div><!-- /.modal-content -->
								  </div><!-- /.modal-dialog -->
								</div><!-- /.modal -->
                                <div class=".tooltip-demo">
                                    <hr/>
                                	<a style="display:none" id ="style"><i class='fa fa-check'></i></a>
                                    <button id="saveChargeCheckOrderBtn" disabled="disabled" type="button" class="btn  btn-primary" data-toggle="tooltip" title="" data-original-title="Default tooltip">保存</button>                                  
                                    <button id="auditBtn" type="button" disabled="disabled" class="btn  btn-primary " data-toggle="tooltip" title="" data-original-title="Default tooltip">确认</button>
                                    <button id="printBtn" type="button" class="btn  btn-primary " data-toggle="tooltip" title="" data-original-title="Default tooltip">打印</button>
                                    <a class="btn  btn-primary" href="/chargeCheckOrder">返回</a>
                                    <button id="deleteBtn" type="button" class="btn  btn-danger <% if(login_id!'' != arapAuditOrder.create_by!''){%>hidden<% }%>" >撤销</button>
                                </div>
                                <!-- <p>保存：新建时只能保存（其他按钮都灰掉不能点）, 保存后单据状态变为“新建”</p>
                                <p>确认：点击后生成单据状态 “已审核”，里程碑中记录审核人，审核时间， 然后生成“结账单”</p> -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>                                
        </div>
     </div>
     <!-- /#page-wrapper -->

<%}%>
<!-- 引入校验的js 文件及其 中文 文件-->
<script src="/yh/js/jquery.validate.min.js"></script>
<script src="/yh/js/jvalidate.messages_cn.js"></script>
<script src="/yh/css/ui/jquery-ui.js"></script>
<script src="/yh/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="/yh/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script>
	var order_no = '${arapAuditOrder.order_no!''}';
	<%
		var returnOrderUpdate = shiro.hasPermission("ReturnOrder.update");
		var returnOrderComplete = shiro.hasPermission("ReturnOrder.completed");
	%>
	var Return = {};
	Return.isUpdate = ${returnOrderUpdate};
	Return.isComplete = ${returnOrderComplete};
</script>

<script src="/yh/js/eeda-common.js"></script>
<script src="/yh/js/plugins/sco/js/sco.message.js"></script>
<script src="/yh/js/plugins/dataTables/jquery.dataTables.editable.js" type="text/javascript"></script>
<script src="/yh/js/bootstrap-datetimepicker.min.js"></script>
<script src="/yh/js/bootstrap-datetimepicker.zh-CN.js"></script>

<script src="/yh/js/arap/ChargeCheckOrder/edit.js?v=1.0"></script>