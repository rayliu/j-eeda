<%layout("/yh/layout.html"){%>
<link href="/yh/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
<link rel="stylesheet" href="/yh/css/ui/jquery-ui.css">
<link href="/yh/js/plugins/sco/css/sco.message.css" rel="stylesheet">
<link href="/yh/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
        <div id="page-wrapper">
            <div class="row">
           
                <div class="col-lg-12">
                    <div class="btn-header" style="font-size: 32px">发车单</div>
                    <input type="hidden" id="departOrderId" value="${departOrder.id!''}">
                    <input type="hidden" id="departOrderStatus" value="${status!''}${departOrder.status!''}">
                    <input type="hidden" id="departOrderArrivalMode" value="${transferOrderAttr.arrival_mode!''}">
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        
                        <!-- /.panel-heading -->
                        <div class="panel-body" id="total">
                  
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs">
                                <li class="active"><a href="#basic" data-toggle="tab" id ="chargeCheckOrderbasic">基本信息</a></li>
                                <li class=""><a href="#cargos" data-toggle="tab" id="departOrderItemList">货品信息</a></li>
                                <li class=""><a href="#milestone" data-toggle="tab" id="transferOrderMilestoneList">里程碑</a></li>
                                <li class=""><a href="#arap" data-toggle="tab" id="arap1">应付</a></li>
                            </ul>
                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div class="tab-pane fade active in" id="basic">
                                <div class="row">
                                   <form id="orderForm" method="post" action="">
                                      <div class="col-lg-6">
                                          <input type="hidden" id="depart_order_token" name="depart_order_token" value="${depart_order_token!}"/>
                                      	  <input type="hidden" name="transfer_type" value="${transfer_type!''}"/>
                                          <input class="" id="last_detail_size" value="${last_detail_size!''}" type="hidden">
            	                            <input class="" id="depart_id" value="${departOrder.id!''}" type="hidden" name="depart_id" >
            	                            <input class="" id="type" value="${type!''}" type="hidden" >
                    	            				<input class="" id="message" value="${localArr!''}" type="hidden" name="orderid" >
                    	            				<input class="" id="tr_itemid_list" value="${tr_itemid!''}" type="hidden" name="tr_itemid_list">
                    	            				<input class="" id="item_detail" value="${item_detail!''}" type="hidden" name="item_detail" >
            	                            <input class="" id="sp_id" value="${departOrder.sp_id!''}" type="hidden" name="sp_id" > 
            	                            <input class="" id="partySpId" value="${partySp.id!''}" type="hidden" name="partySpId" > 
            	                            <input class="" id="check_sh" value="${check_sh!''}" type="hidden" name="" >
            	                            <input type="hidden" name="order_no" value="${order_no!''}${departOrder.depart_no!''}"/>
                                         	<input type="hidden" name="status" value="${status!''}${departOrder.status!''}"/>
                                         	<input type="hidden" name="create_by" value="${create_by!''}${departOrder.create_by!''}"/>
          	                              	<input id="carinfoId" type="hidden" name="carinfoId" value="${departOrder.carinfo_id!''}"/> 
          	                       		    <input id="driver_id" type="hidden" name="driver_id" value="${departOrder.driver_id!''}"/>
                                            <input id="checkedDetail" type="hidden" name="checkedDetail"/>                                    	
          		                            <input id="uncheckedDetail" type="hidden" name="uncheckedDetail"/>
          		                            <input type="hidden" name="routeSp" value="${routeSp!''}"/>
          		                            <input type="hidden" name="audit_status" id="audit_status" value="${audit_status!''}${departOrder.audit_status!''}"/>
          		                            <input type ="hidden" name='pickupIds'  id="pickupIds"  value="${pickupIds!''}">
          		                            <input type ="hidden" name='volume'  id="volume"  value="${departOrder.volume!''}">
                                   		   
	                                        <div class="form-group">
                                                <label><h3>计费方式</h3></label>
                                                <input type="hidden" id="transferOrderChargeType" value="${transferOrder.charge_type2!''}">
                                                <input type="hidden" id="departOrderChargeType" value="${departOrder.charge_type!''}">
                                                <input type="hidden" id="hiddenDepartOrderCarType" value="${departOrder.car_type!''}">
                                                <label class="radio-inline">
                                                    <input type="radio" name="chargeType" id="chargeType1" value="perUnit" checked>计件
                                                </label>
                                                <label class="radio-inline">
                                                    <input type="radio" name="chargeType" id="chargeType2" value="perCar">整车
                                                </label>  
                                                <label class="radio-inline">
                                                    <input type="radio" name="chargeType" id="chargeType3" value="perCargo">零担
                                                </label> 
                                          </div>
                                          <div style="display: none;" class="form-group" id="car_type_div" >
                                              <lable>车辆规格(M),载重(T),集装箱(GP)</lable>
                                              <select class="form-control" id="car_type" name="car_type">
                                                  <option></option>
                                                  <option>40GP</option>
                                                  <option>20GP</option>
                                                  <option>40T</option>
                                                  <option>20T</option>
                                                  <option>10T</option>
                                                  <option>8T</option>
                                                  <option>5T</option>
                                                  <option>3T</option>
                                                  <option>21M</option>
                                                  <option>18.5M</option>
                                                  <option>18.0M</option>
                                                  <option>17.8M</option>
                                                  <option>17.5M</option>
                                                  <option>17.0M</option>
                                                  <option>16.0M</option>
                                                  <option>15.0M</option>
                                                  <option>14.5M</option>
                                                  <option>13.5M</option>
                                                  <option>13.0M</option>
                                                  <option>12.5M</option>
                                                  <option>9.6M</option>
                                                  <option>8.6M</option>
                                                  <option>8.0M</option>
                                                  <option>7.6M</option>
                                                  <option>7.2M</option>
                                                  <option>6.8M</option>
                                                  <option>6.5M</option>
                                                  <option>5.3M</option>
                                                  <option>4.3M</option>
                                                  <option>4.2M</option>
                                                  <option>2.6M</option>
                                              </select>
                                          </div>
                                          <div style="display: none;" class="form-group" id="ltl_price_type" >
                                              <lable>零担计费方式:  </lable>
                                              <input type="hidden" id="hibLtlUnitType" value="${departOrder.ltl_price_type!''}">
                                              <label class="radio-inline">
                                                  <input type="radio" name="ltlUnitType" id="optionsRadiosIn1" value="perCBM" checked>按体积（每立方米）
                                              </label>
                                               <label class="radio-inline">
                                                  <input type="radio" name="ltlUnitType" id="optionsRadiosIn3" value="perKg">按重量（每公斤）
                                              </label>
                                              <label class="radio-inline">
                                                  <input type="radio" name="ltlUnitType" id="optionsRadiosIn2" value="perTon">按重量（每吨）
                                              </label>
                                          </div>
                                   		    <div class="form-group">
                                               <h2>供应商信息</h2>
                                               <input type="text" value="${spContact.company_name!''}" name="spMessage" placeholder="选择供应商" class="form-control" id="spMessage">
                                               <ul style="top: 35%; left: 2%;" tabindex="-1" class="pull-right dropdown-menu default dropdown-scroll" id="spList"></ul>   										
                                           </div>
                                           <div class="form-group">     
                                           	   <h5 id="pageSpName">${spContact.contact_person!''} ${spContact.phone!''}</h5><h5 id="pageSpAddress">${spContact.address!''}</h5>     
                                           </div>                                                
                                    <div id="carInfomation" style="display:none">      
                                        <h2>车辆信息</h2>
                                        <div class="form-group">
                                            <label>车牌</label>
                                             <div class="form-group">											
										        <input type="text" name="car_no" class="form-control" id="carNoMessage" value="${carinfo.car_no!''}">
										        <ul style="top: 17%; left: 2%;" tabindex="-1" class="pull-right dropdown-menu default" id="carNoList">
												</ul>
										    </div>
                                        </div> 
                                        <div class="form-group">
											<label>司机</label>
										    <div class="form-group">														    								
										        <input type="hidden" id="carInfoDriverMessage" value="${carinfo.driver!''}">										
										        <input type="text" name="driver_name" class="form-control" id="driverMessage" value="${driverContact.contact_person!''}">
										        <ul style="top: 17%; left: 2%;" tabindex="-1" class="pull-right dropdown-menu default" id="driverList">
												</ul>
										    </div>
									    </div>
									                                     
                                        <div class="form-group">
                                        <label>电话</label>
                                        <input id="carInfoDriverPhone" value="${carinfo.phone!''}" type="hidden">
                                        <input class="form-control" id="driver_phone" value="${driverContact.phone!''}"  name="driver_phone">
                                        </div> 
	                                       <div id="carFollowInfomation" style="display:none">
	                                         	<div class="form-group">
		                                            <label>跟车人</label>
		                                            <input class="form-control" id="car_follow_name" value="${departOrder.car_follow_name!''}" name="car_follow_name">
	                                            </div>
	                                                                               
	                                            <div class="form-group">
		                                            <label>跟车人电话</label>
		                                            <input class="form-control" id="car_follow_phone" value="${departOrder.car_follow_phone!''}" name="car_follow_phone">
	                                            </div>
                                            </div>
                                       </div>       
                                       <div class="row">			                                    
	                                    	<div class="col-lg-10">                                
		                                       <div class="form-group">
		                                           <label class="search-label">供应商托运单号<span style ="color:red">*</span></label>
					                               <input type="text" class="form-control search-control orderNo_filter" id="booking_note_number" name="booking_note_number" value="${departOrder.booking_note_number!''}">
		                                       </div> 
                                       		</div>
                                       </div>
	                                   <div class="row">			                                    
	                                   		<div class="col-lg-10">
		                                        <div class="form-group">                                                    
		                                            <span id="datetimepicker" class="input-append date search-control "> 
		                                                <label class="search-label">实际发车时间<span style ="color:red">*</span></label> 
		                                                <input id="departure_time" class="form-control search-control endTime_filter" type="text" name="departure_time" value="${departOrder.departure_time!''}">
		                                                <span class="add-on">  
		                                                    <i class="fa fa-calendar" data-time-icon="icon-time" data-date-icon="icon-calendar"></i>  
		                                                </span>  
		                                            </span>
		                                        </div>
		                                    </div>
		                                </div>
	                                    <div class="row">
		                                    <div class="col-lg-10">
		                                        <div class="form-group">                                                    
		                                            <span id="datetimepicker2" class="input-append date search-control "> 
		                                                <label class="search-label">预计到达时间<span style ="color:red">*</span></label> 
		                                                <input id="arrival_time" class="form-control search-control endTime_filter" type="text" name="arrival_time" value="${departOrder.arrival_time!''}">
		                                                <span class="add-on">  
		                                                    <i class="fa fa-calendar" data-time-icon="icon-time" data-date-icon="icon-calendar"></i>  
		                                                </span>  
		                                            </span>
		                                        </div>
		                                    </div>
		                                </div>
		                                <div class="row" id="w_v" style="display:none;">			                                    
	                                    	<div class="col-lg-10">                                
		                                       <div class="form-group">
		                                           <label class="search-label">货品总体积/(m³):</label>
					                               <input type="text" class="form-control search-control orderNo_filter" disabled="disabled" id="" name="" value="${departOrder.volume!''}">
		                                       </div> 
                                       		</div>		                                    
	                                    	<div class="col-lg-10">                                
		                                       <div class="form-group">
		                                           <label class="search-label">货品总重量/(公斤):</label>
					                               <input type="text" class="form-control search-control orderNo_filter" disabled="disabled" id="" name="" value="${departOrder.weight!''}">
		                                       </div> 
                                       		</div>
                                       </div>
                                   	</div>
                                      <div class="col-lg-6">
                                      <h2>发车信息</h2>  
                                         <div class="form-group">
	                                        <label>发车单号</label> <strong id="showDepartNo">${order_no!''} ${departOrder.depart_no!''}</strong>
	                                        </div>
	                                        <div class="form-group">
	                                            <label>单据状态</label>   <span id="departStatus">${status!''}${departOrder.status!''}</span>
	                                        </div>
	                                        <div class="form-group">
	                                        <label>创建人</label>  <%if(userLogin.c_name!''==''){ %>${userLogin.user_name!''}<%}else{%>${userLogin.c_name!''}<%}%>
	                                        <%if(userLogin2.c_name!''==''){ %>${userLogin2.user_name!''}<%}else{%>${userLogin2.c_name!''}<%}%>                                        
	                                        </div>                                                            
									
                                          <div class="form-group">
                                         <label>始发城市</label>
                                          <div class="form-control" style="padding: 0px 0px;box-shadow:none;border:none;height:35px;" >
                                            <input id="locationForm" type="hidden" name="route_from" value="${locationFrom.code!''}">
                                            <input id="hideLocationFrom" type="hidden"> 
                        
                                               <label>省</label>
                                               <input id="hideProvinceFrom" type="hidden" value="${locationFrom.province!''}"/>
                                               <select id="mbProvinceFrom" class="valid" name="mbProvinceFrom" value=""></select>
                                               <label>市</label>
                                               <input id="hideCityFrom" type="hidden" value="${locationFrom.city!''}"/>
                                               <select  id="cmbCityFrom" class="valid" name="cmbCityFrom" value=""></select>
                                               <label>区(县)</label>
                                               <input id="hideDistrictFrom" type="hidden" value="${locationFrom.district!''}" style="width: 26%"/>
                                               <select  id="cmbAreaFrom" class="valid" name="cmbAreaFrom" value=""></select>
                                            	</div>
                                            </div>
        									              <div class="form-group" >
                                            <input id="locationTo" type="hidden" name="route_to" value="${locationTo.code!''}">
                                           	<label>目的地城市</label>
		                                        <div class="form-control" style="padding: 0px 0px;box-shadow:none;border:none;height:35px;">
		                                        <label>省</label>
		                                        <input id="hideProvinceTo" type="hidden" value="${locationTo.province!''}"/>
		                                        <select id="mbProvinceTo" class="valid" name="mbProvinceTo" value=""></select>
		                                        <label>市</label>
		                                        <input id="hideCityTo" type="hidden" value="${locationTo.city!''}"/>
		                                        <select  id="cmbCityTo"  class="valid" name="cmbCityTo" value=""></select>
		                                        <label>区(县)</label>
		                                        <input id="hideDistrictTo" type="hidden" value="${locationTo.district!''}" />
		                                        <select  id="cmbAreaTo" class="valid" name="cmbAreaTo" value=""></select>
		                                    	</div>
		                                    </div>
	                                        <div class="form-group">
	                                            <label>备注</label>
	                                            <textarea class="form-control" rows="4" id="remark" name="remark" style=" height: 108px">${departOrder.remark!''}</textarea>
	                                        </div> 
		                                     <%if(notifi_check!''==true){%>
		                                    <div style="" id="contactInformation">
		                                     <h2>收货人信息</h2>
    	                                         <div class="form-group">
				                                           	 <label>收货地址 :</label>
				                                           	 <label id="notify_address" class="radio-inline"></label>    
        	                                        </div>
        	                                        <div class="form-group">
        	                                            <label>联系人:</label>
        	                                            <label id="notify_contact_person" class="radio-inline"></label>
        	                                          
        	                                        </div>
        	                                        <div class="form-group">
        	                                            <label>电话:</label>
        	                                            <label id="notify_phone" class="radio-inline"></label>
        	                                        </div>
                                            </div>
                                            <%}%>
                                </div>         
                                  </form>
                            </div>
                                </div>
                                <div class="tab-pane fade" id="cargos">
                                     <div class="panel-body" style="" id="ATMitem">
                                     <div class="table-responsive">                                        
		                                <table class="table table-striped table-bordered table-hover" id="departItem-table">                              
		                                <thead>
		                                        <tr>
		                                        	<th>客户</th> 
		                                        	<th>运输单号</th> 
		                                        	<th>计划时间</th> 
		                                         	<th>型号</th> 
		                                            <th>名称</th>
		                                            <th>数量</th>                                   
		                                            <th>体积</th> 
		                                            <th>重量</th> 
		                                            <th>备注</th>                                          
		                                           <th>操作</th>
		                                        </tr>
		                                    </thead>                               
		                                    <tbody>                                                                                                   
		                                    </tbody>
		                                </table>                                
                                     </div>
                                        <!-- /.table-responsive -->
                                        <div style="display: none" id="transferOrderItemDateil">
	                                          <div class="btn-header">单品列表</div>
	 											                    <input id="item_id" value=0 type="hidden" >
	                                           <div class="table-responsive">
	                                          
	                                            <table id="detailTable" class="table table-striped table-bordered table-hover dataTable">
	                                                <thead>
	                                                    <tr role="row">
		                                                <th class="sorting"></th>
		                                                <th class="sorting">名称</th>
		                                                <th class="sorting">型号</th>
		                                                <th class="sorting_asc">序列号</th>
		                                                <th class="sorting">体积</th>
		                                                <th class="sorting">重量</th>
		                                                <th class="sorting">备注</th>	                                                  
		                                                </tr>
	                                                </thead>
	                                                </table>
	                                          </div>  
                    					          </div>   
                                    </div> 
                                </div>  
                              
                              <div class="modal fade" id="transferOrderMilestone" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                              	<div class="modal-dialog">
								    <div class="modal-content">
	                     				<form id="transferOrderMilestoneForm" action="">
								      	<div class="modal-header">
	   								        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	   								        <h4 class="modal-title" id="myModalLabel">新里程碑</h4>
	   								    </div>
	   								    <div class="modal-body">
	   								      	<input id="milestoneDepartId" type="hidden" name="milestoneDepartId" />
	   								      	<div class="form-group ">
	 										<label class="control-label" for="inputSuccess">状态(不填默认为"在途")</label> 
	 										<input id="status" class="form-control" type="text" name="status">
		   									</div>
											<div class="form-group ">
												<label class="control-label" for="inputSuccess">地点</label> 
												<input id="location" class="form-control" type="text" name="location">
											</div>
	                       			  	</div>    
	                       			  	<div class="modal-footer">
									        <button type="button" class="btn  btn-primary" data-dismiss="modal">取消</button>
									        <button id="transferOrderMilestoneFormBtn" type="button" class="btn  btn-primary">保存</button>
									    </div>
										</form>
								    </div><!-- /.modal-content -->
							    </div>
							  </div><!-- /.modal -->
                              <div id="milestone" class="tab-pane fade">
                                <div class="panel-body">
                                        <div class="table-responsive">                                        
       			                             <button id="edit_status"  data-target="#transferOrderMilestone" data-toggle="modal" class="btn  btn-primary" >
       										  	新里程碑
       										 </button>
       										 <div class="form-group "></div>
                                             <table class="table table-striped table-bordered table-hover">
                                                 <thead>
                                                     <tr>
                                                         <th>状态</th>
                                                         <th>地点</th>
                                                         <th>更新用户</th>
                                                         <th>更新时间</th>
                                                     </tr>
                                                 </thead>
                                                 <tbody id="transferOrderMilestoneTbody"></tbody>
                                             </table>
                                        </div>
                                        <!-- /.table-responsive -->                                   
                                    </div><!-- /.panel-body -->
                                  </div>
                                    

                                <div class="tab-pane fade" id="arap">
                                    <div class="panel-body">
										<button class="btn  btn-primary" id="addrow"> 添加应付</button>
                                        
                                        <div class="table-responsive">
                                           <br>
                                            <table class="table table-striped table-bordered table-hover"  id ="table_fin2" style="width: 1400px;">
                                                <thead>
                                                    <tr>
                                                        <th>运输单号</th>
                                                        <!-- <th>货品名称</th> -->
                                                        <th>货品总数</th>
                                                        <th>总体积</th>
                                                        <th>总重量</th>
                                                        <th>费用条目</th>
                                                        <th>计费单价</th>
                                                        <th>金额</th>
                                                        <th>计费方式</th>
                                                        <th>始发地</th>
                                                        <th>目的地</th>
                                                        <th>备注</th>
                                                        <th>结算状态</th>
                                                        <th>费用来源</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    
                                                </tbody>
                                                <div id="paymentItemList" style="display:none;">
	                                            	<%for(paymentItem in paymentItemList){ %>
                    	   														<option value='${paymentItem.ID!''}'>${paymentItem.NAME!''}</option>
                    	   												<%}%>
                                            	</div>
                                            </table>
                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>
                                    <!-- /.panel-body -->
                            </div>                   					
                        <!-- /.panel-body -->
                    <!-- /.panel -->
                </div>
                
                <div class="modal fade" id="detailDialog" tabindex="-1">
							     <div class="modal-dialog">
                                <div class="col-lg-4" class="col-lg-4" style="border-top-width: 0px; margin-top: 100px; width: 350px; height: 200px; margin-left: 150px;">
	                    			<div class="panel panel-default">
		                       			<div class="panel-heading">
		                            		温馨提示
		                        		</div>
		                       			<div class="panel-body">
		                            		<p>单据创建完毕,是否继续创建？</p>
		                        		</div>
		                        		<form id="detailCheckBoxForm" method="post" action="/departOrder/createDepartOrder">
		                        			<input type="hidden" name="localArr" value="${localArr!''}">
			                       			<div class="panel-footer">
			                          			<button id="cancelBtn" type="button" class="btn  btn-primary" data-toggle="tooltip" title="" data-original-title="Default tooltip">否</button>
			                          			<button id="continueCreateBtn" type="button" class="btn  btn-primary" data-toggle="tooltip" title="" data-original-title="Default tooltip">是</button>
			                        		</div>                        		
		                        		</form>
	                   				</div> 
				                </div>
			                </div>      
			            </div> 
                    	<div class=".tooltip-demo">
	                        <hr/>
	                          <a style="display:none" id ="style"><i class='fa fa-check'></i></a>  
	                          <% if(shiro.hasPermission("DepartOrder.create") || shiro.hasPermission("DepartOrder.update")){%>                          
		             		        <button id="saveDepartOrderBtn" disabled="disabled" type="button" class="btn  btn-primary" data-toggle="tooltip" title="" data-original-title="Default tooltip">保存</button>
		             		  <%}%>
		             		  <% if(shiro.hasPermission("DepartOrder.completed")){%>
                            		<button id="departureConfirmationBtn" type="button" class="btn  btn-primary " data-toggle="tooltip" title="" data-original-title="Default tooltip">发车确认</button>
                              <%}%>
                          	<a class="btn  btn-primary" href="/departOrder">返回</a>
                          	<button id="deleteBtn" type="button" class="btn  btn-danger">撤销</button>
                        </div>
                    	<div class="form-group">
                    </div>
                        
                <!-- /.col-lg-12 -->
            </div>
            
        </div>
        <!-- /#page-wrapper -->

<%}%>
<script src="/yh/css/ui/jquery-ui.js"></script>
<script src="/yh/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="/yh/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="/yh/js/plugins/dataTables/jquery.dataTables.editable.js" type="text/javascript"></script>
<script src="/yh/js/plugins/dataTables/jquery.jeditable.js" type="text/javascript"></script>
<script src="/yh/js/jquery.validate.min.js"></script>
<script src="/yh/js/jvalidate.messages_cn.js"></script>
<script type="text/javascript">
	var departOrder = {};
	departOrder.orderNo = "${order_no!''}" ;
	departOrder.departNo = "${departOrder.depart_no!''}";
</script>

<script src="/yh/js/departOrder/edit.js"></script>
<script src="/yh/js/plugins/sco/js/sco.message.js"></script>
<script src="/yh/js/eeda-common.js"></script>


<script src="/yh/js/bootstrap-datetimepicker.min.js"></script>
<script src="/yh/js/bootstrap-datetimepicker.zh-CN.js"></script>
