<%layout("/yh/layout.html"){%>

        <div id="page-wrapper">
            <div class="row">
           
                <div class="col-lg-12">
                    <h1 class="page-header">发车单</h1>                  
                  
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        
                        <!-- /.panel-heading -->
                        <div class="panel-body" id="total">
                  
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs">
                                <li class="active"><a href="#basic" data-toggle="tab">基本信息</a>
                                </li>
                                <li class=""><a href="#cargos" data-toggle="tab">货品信息</a>
                                </li>
                                <li class=""><a href="#arap" data-toggle="tab">应付</a>
                                </li>
                            </ul>

                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div class="tab-pane fade active in" id="basic">
                                 
                                <div class="row">
                                   <form  method="post" action="/yh/departOrder/savedepartOrder">
                               <div class="col-lg-6">
                               <input class="" id="depart_id" value="${depart_id}" type="hidden" name="depart_id" >
                             <input class="" id="type" value="${type}" type="hidden" >
            				 <input class="" id="message" value="${localArr}" type="hidden" name="orderid" >
                                    
                                   		  <h2>车辆信息</h2>  
                                   		   
                                           
                                          <div class="form-group">
											<label>司机</label>
										    <div class="form-group">
										        <!--label>司机名称</label-->
										        <input type="hidden" id="driverId" name="driverid">
										        <input type="text" name="customerMessage" placeholder="选择司机" class="form-control" id="customerMessage" value="">
										        <ul style="top: 17%; left: 2%;" tabindex="-1" class="pull-right dropdown-menu default" id="customerList">
												</ul>
										    </div>
									    </div>
                                        
                                         <div class="form-group">
                                            <label>车牌</label>
                                             <input class="form-control" id="car_no" value=""  name="car_no">
                                        </div>
                                         <div class="form-group">
                                        <div  style=display:inline-block;width:49%>
                                            <label>车型</label>
                                             <select name="cartype" id="cartype" class="form-control">
                                                                <option>全部</option>
                                                                <option>平板车</option>
                                                                <option>高栏车</option>
                                                                <option>集装车</option>
                                                                <option>单桥车</option>
                                                                <option>双桥车</option>
                                                                <option>半挂车</option>
                                                                <option>冷藏车</option>
                                                                <option>特种车</option>
                                                                <option>商品运输车</option>
                                                                <option>危险品车</option>
                                                                <option>挂车</option>
                                                                <option>爬梯车</option>
                                                                <option>可拼车</option>
                                                                <option>低栏车</option>
                                                                <option>半挂一拖二</option>
                                                                <option>半挂一拖三</option>
                                                                <option>半挂二拖二</option>
                                                                <option>半挂二拖三</option>
                                                                <option>前四后四</option>
                                                                <option>前四后六</option>
                                                                <option>前四后八</option>
                                                                <option>前四后十</option>
                                                                <option>五轮车</option>
                                                                <option>后八轮</option>
                                                                <option>半封闭</option>
                                                                <option>封闭车</option>
                                                                <option>罐式车</option>
                                                                <option>厢式车</option>
                                                                <option>自卸车</option>
                                                                <option>棉被车</option>
                                                                <option>其他</option>
                                                            </select>
                                                            </div>
                                                         <div   style=display:inline-block;width:50%>
                                                               
                                            <label>长度</label>
                                             <select name="carsize" id="carsize" class="form-control"  >
                                                                <option>15</option>
                                                                <option>20</option>
                                                                <option>25</option>
                                                               
                                                            </select>
                                       </div>
                                        </div>
                                      
                                            <div class="form-group">
                                            <label>电话</label>
                                             <input class="form-control" id="phone" value=""  name="phone">
                                        </div>

                                        <div class="form-group">
                                        <button class="btn btn-default" type="submit">&nbsp&nbsp&nbsp&nbsp保存&nbsp&nbsp&nbsp&nbsp</button>
                                          
                                         </div>
                                    </div>
                                      <div class="col-lg-6">
                                  <h2>发车信息</h2>  
                                         <div class="form-group">
                                            <label>发车类型</label></br>
                                            <div class="form-control" style=box-shadow:none;border:none>
                                          <label class="radio-inline">
                                           <input type="radio" value="one" id="ordertypeone" name="ordertype">一车一单
                                          </label>
                                          
                                           <label class="radio-inline">
                                           <input type="radio" value="many" id="ordertypetwo" name="ordertype">一车多单
                                          </label>
                                           </div>
                                        </div>
                                        
                                         
                                        <div class="form-group">
                                            <label>创建人</label>
                                             <input class="form-control" id="create" value="${creat}"  name="create">
                                        </div>                                                                               
										<div class="form-group">
                                            <label>备注</label>
                                            <textarea class="form-control" rows="4" id="remark" name="remark"></textarea>
                                        </div> 
                                 		
                                    
                                </div>
                                	
                                  
                                     
                                  </form>

                            </div>
                                </div>
                                
                                
                                <div class="tab-pane fade" id="cargos">
                                   
                                    
                                     <div class="panel-body" style="" id="ATMitem">
                                        <div class="table-responsive">
                                        
                                <table class="table table-striped table-bordered table-hover" id="eeda-table">
                              
                                <thead   >
                                        <tr>
                                        	<th>客户</th> 
                                        	<th>运输单号</th> 
                                         	<th>序列号</th> 
                                            <th>名称</th>
                                            <th>数量</th>                                   
                                            <th>体积</th> 
                                            <th>重量</th> 
                                            <th>备注</th>                                          
                                           <th>操作</th>
                                        </tr>
                                    </thead>                               
                                    <tbody>
                                        <tr>
                                      
                                         <td>yd20132014123</td>
                                         <td>xlk25642</td>
                                          <td>ATM</td>
                                           <td>1</td>
                                            <td>100</td>
                                            <td>200kg</td>
                                            <td>一台ATM机</td>
                                        </tr>                                                                                                     
                                    </tbody>
                                </table>
                       
                                          
                                        </div>
                                        <!-- /.table-responsive -->
                                        <div style="display: none" id="transferOrderItemDateil">
	                                            <h3 class="page-header">单品列表</h3>
	 											<input id="item_id" value=0 type="hidden" >
	                                           <div class="table-responsive">
	                                          
	                                            <table id="detailTable" class="table table-striped table-bordered table-hover dataTable">
	                                                <thead>
	                                                    <tr role="row">
	                                                    <th class="sorting"  >名称</th>
	                                                    <th class="sorting"  >型号</th>
	                                                    <th class="sorting_asc"  >序列号</th>
	                                                    <th class="sorting"  >体积</th>
	                                                    <th class="sorting"  >重量</th>
	                                                    <th class="sorting" >备注</th>
	                                                  
	                                                    </tr>
	                                                </thead>
	                                                </table>
	                                          </div>
                                            </div>
                                    </div>
                                  
                                    <!-- /.panel-body -->
                                      <!-- 模态框 -->
									
                                </div>
                              
                                <div class="tab-pane fade" id="arap">
                                    <h2>应收</h2>
                                    <div class="panel-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-bordered table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        <th>费用条目</th>
                                                        <th>金额</th>
                                                        <th>备注</th>
                                                        <th>结算状态</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="pay">
                                                       <tr>
                                                       <td></td>
                                                       <td>运输费</td>
                                                       <td>1000</td>
                                                       <td>运输费用费</td>
                                                       <td>未结算</td>
                                                       </tr>                                               
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>
                                    <!-- /.panel-body -->
                                    
                                  
                             
                                    <!-- /.panel-body -->
                                </div>
                                
                                
                             
                            </div>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->

            </div>
        </div>
        <!-- /#page-wrapper -->

<%}%>
<script src="/yh/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="/yh/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="/yh/js/jquery.validate.min.js"></script>
<script src="/yh/js/jvalidate.messages_cn.js"></script>
<script>
    $(document).ready(function() {
        $('#menu_assign').addClass('active').find('ul').addClass('in');
        var message=$("#message").val();
        var type=$("#type").val();
        var depart_id=$("#depart_id").val();
      if(type=="one"){
    	  $("#ordertypeone").attr('checked', 'checked');
      }else{
    	  $("#ordertypetwo").attr('checked', 'checked');
      }
      if(depart_id!="no"){
    		$.get('/yh/departOrder/editshow', {depart_id:depart_id}, function(data){ 
    			$('#customerMessage').val(data[0].CONTACT_PERSON);
    			$('#car_no').val(data[0].CAR_NO);
    			$('#cartype').val(data[0].CAR_TYPE);
    			$('#carsize').val(data[0].CAR_SIZE);
    			$('#phone').val(data[0].PHONE);
    			$('#create').val(data[0].USER_NAME);
    		},'json');
    		
      }
      
      $('#customerMessage').on('keyup', function(){
  		var inputStr = $('#customerMessage').val();
  		if(inputStr == ""){
  			$('#phone').val($(this).attr(""));
  		}
  		$.get('/yh/departOrder/searchCustomer', {input:inputStr}, function(data){
  			console.log(data);
  			var customerList =$("#customerList");
  			customerList.empty();
  			for(var i = 0; i < data.length; i++)
  			{
  				customerList.append("<li><a tabindex='-1' class='fromLocationItem' partyId='"+data[i].PID+"' post_code='"+data[i].POSTAL_CODE+"' contact_person='"+data[i].CONTACT_PERSON+"' email='"+data[i].EMAIL+"' phone='"+data[i].PHONE+"' cid='"+data[i].ID+"' address='"+data[i].ADDRESS+"', company_name='"+data[i].COMPANY_NAME+"', > "+data[i].CONTACT_PERSON+" "+data[i].PHONE+"</a></li>");
  			}
  		},'json');
  		
  		$("#customerList").css({ 
          	left:$(this).position().left+"px", 
          	top:$(this).position().top+32+"px" 
          }); 
          $('#customerList').show();
  	});
  	
  	// 选中客户
  	$('#customerList').on('click', '.fromLocationItem', function(e){
  		var message = $(this).text();
  	
  		$('#driverId').val($(this).attr('partyId'));
  		$('#customerMessage').val($(this).attr('CONTACT_PERSON'));
  		$('#phone').val($(this).attr('phone'));
          $('#customerList').hide();
          
         
      }); 
    	var datatable = $('#eeda-table').dataTable({
            //"sDom": "<'row-fluid'<'span6'l><'span6'f>r>t<'row-fluid'<'span12'i><'span12 center'p>>",
            "sDom": "<'row-fluid'<'span6'l><'span6'f>r>t<'row-fluid'<'span12'i><'span12 center'p>>",
            //"sPaginationType": "bootstrap",
            "iDisplayLength": 10,
            "bServerSide": true,
        	"oLanguage": {
                "sUrl": "/eeda/dataTables.ch.txt"
            },
            "sAjaxSource": "/yh/departOrder/getIintDepartOrderItems?localArr="+message+"",
            "aoColumns": [
                { "mDataProp": "CUSTOMER" ,"sWidth": "100%"},
                { "mDataProp": "ORDER_NO" ,"sWidth": "30%"},      
                { "mDataProp": "SERIAL_NO"},
                { "mDataProp": "ITEM_NAME"},
                { "mDataProp": "AMOUNT"},
                { "mDataProp": "VOLUME"},
                { "mDataProp": "WEIGHT"},
                { "mDataProp": "REMARK"},
                { 
                    "mDataProp": null, 
                    "sWidth": "8%",                
                    "fnRender": function(obj) {                    
                        return "<a class='btn btn-success dateilEdit' code='?id="+obj.aData.ID+"'>"+
                                    "<i class='fa fa-search fa-fw'></i>"+
                                    "查看"+
                                "</a>"+					
                                "<a class='btn btn-danger cancelbutton' href=''>"+
                                    "<i class='fa fa-trash-o fa-fw'></i>"+ 
                                    "取消"+
                                "</a>";
                    },
                }
                                          
            ]      
        });	
    	
    	
    	// 编辑单品
    		$("#eeda-table").on('click', '.dateilEdit', function(e){
    			e.preventDefault();
    			
    			$("#transferOrderItemDateil").show();
    			//alert("12345");
    			 var code = $(this).attr('code');
    			var itemId = code.substring(code.indexOf('=')+1);
    			$("#item_id").val(itemId);
    			detailTable.fnSettings().sAjaxSource = "/yh/departOrder/itemDetailList?item_id="+itemId+"";
    			detailTable.fnDraw();   
    			
    		});
    		
    		var item_id = $("#item_id").val();
    		var detailTable= $('#detailTable').dataTable({           
                "sDom": "<'row-fluid'<'span6'l><'span6'f>r>t<'row-fluid'<'span12'i><'span12 center'p>>",  
                "iDisplayLength": 10,
                "bServerSide": true, 
            	"oLanguage": {
                    "sUrl": "/eeda/dataTables.ch.txt"
                },
               "sAjaxSource": "/yh/departOrder/itemDetailList?item_id="+item_id+"",
                "aoColumns": [
    
                    { "mDataProp": "ITEM_NAME"},      
                    { "mDataProp": "ITEM_NO"},
                    { "mDataProp": "SERIAL_NO"},
                    { "mDataProp": "VOLUME"},
                    { "mDataProp": "WEIGHT"},
                    { "mDataProp": "REMARK"},
                                              
                ]  
            });	
        	 
    	
    });
</script>